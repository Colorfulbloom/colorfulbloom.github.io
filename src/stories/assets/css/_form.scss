@use 'sass:color';
@use 'variables' as *;

// ─── Shared tokens ──────────────────────────────────────────────────────────
$form-radius: 10px; // matches %btn-base border-radius
$form-bg: $charcoal;
$form-border: rgba($pewter, 0.25);
$form-border-focus: $azure-bolt;
$form-text: $quicksilver;
$form-placeholder: $pewter;
$form-label-color: $quicksilver;
$form-disabled-opacity: 0.45;

// ─── Label ──────────────────────────────────────────────────────────────────
.form-label {
  display: block;
  margin-bottom: 0.375rem;
  font-family: $font-body;
  font-size: 0.875rem;
  font-weight: 600;
  color: $form-label-color;
  letter-spacing: 0.01em;
}

.form-helper {
  display: block;
  margin-top: 0.25rem;
  font-family: $font-body;
  font-size: 0.8rem;
  color: $pewter;
}

// ─── Shared input base (text input, textarea, select) ───────────────────────
%form-control-base {
  display: block;
  width: 100%;
  padding: 0.75rem 1rem;
  font-family: $font-body;
  font-size: 1rem;
  font-weight: 400;
  color: $form-text;
  background-color: $form-bg;
  border: 1px solid $form-border;
  border-radius: $form-radius;
  transition: border-color $transition-fast,
              box-shadow $transition-fast;

  &::placeholder {
    color: $form-placeholder;
  }

  &:hover {
    border-color: rgba($pewter, 0.45);
  }

  &:focus {
    outline: none;
    border-color: $form-border-focus;
    box-shadow: 0 0 0 3px rgba($azure-bolt, 0.25);
  }

  &:disabled {
    opacity: $form-disabled-opacity;
    cursor: not-allowed;
  }
}

// ─── Text input ─────────────────────────────────────────────────────────────
.form-input {
  @extend %form-control-base;
  height: auto; // override any Bootstrap fixed height

  &--error {
    border-color: #D94F4F;

    &:focus {
      border-color: #D94F4F;
      box-shadow: 0 0 0 3px rgba(#D94F4F, 0.25);
    }
  }
}

// ─── Textarea ───────────────────────────────────────────────────────────────
.form-textarea {
  @extend %form-control-base;
  min-height: 120px;
  resize: vertical;
  line-height: 1.5;
}

// ─── Select ─────────────────────────────────────────────────────────────────
.form-select-wrapper {
  position: relative;
  display: block;
  width: 100%;
}

.form-select {
  @extend %form-control-base;
  appearance: none;
  padding-right: 2.5rem; // space for custom arrow
  cursor: pointer;

  // Custom dropdown arrow
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%238E8E8E' d='M1.41.59 6 5.17 10.59.59 12 2l-6 6-6-6z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;

  &:focus {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%230070BD' d='M1.41.59 6 5.17 10.59.59 12 2l-6 6-6-6z'/%3E%3C/svg%3E");
  }

  &:disabled {
    cursor: not-allowed;
  }

  option {
    background-color: $charcoal;
    color: $quicksilver;
  }
}

// ─── Checkbox ───────────────────────────────────────────────────────────────
.form-checkbox {
  display: inline-flex;
  align-items: center;
  gap: 0.625rem;
  cursor: pointer;
  font-family: $font-body;
  font-size: 0.95rem;
  color: $form-text;

  &__input {
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    background-color: $form-bg;
    border: 1px solid $form-border;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color $transition-fast,
                border-color $transition-fast,
                box-shadow $transition-fast;
    position: relative;

    &::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 6px;
      width: 5px;
      height: 10px;
      border: solid $quicksilver;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
      opacity: 0;
      transition: opacity $transition-fast;
    }

    &:hover {
      border-color: rgba($pewter, 0.45);
    }

    &:focus-visible {
      outline: none;
      border-color: $azure-bolt;
      box-shadow: 0 0 0 3px rgba($azure-bolt, 0.25);
    }

    &:checked {
      background-color: $azure-bolt;
      border-color: $azure-bolt;

      &::after {
        opacity: 1;
      }
    }

    &:disabled {
      opacity: $form-disabled-opacity;
      cursor: not-allowed;
    }
  }

  &__label {
    user-select: none;
  }

  &--disabled {
    opacity: $form-disabled-opacity;
    cursor: not-allowed;
  }
}

// ─── Radio ──────────────────────────────────────────────────────────────────
.form-radio {
  display: inline-flex;
  align-items: center;
  gap: 0.625rem;
  cursor: pointer;
  font-family: $font-body;
  font-size: 0.95rem;
  color: $form-text;

  &__input {
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    background-color: $form-bg;
    border: 1px solid $form-border;
    border-radius: 50%;
    cursor: pointer;
    transition: background-color $transition-fast,
                border-color $transition-fast,
                box-shadow $transition-fast;
    position: relative;

    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0.5rem;
      height: 0.5rem;
      background-color: $quicksilver;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity $transition-fast;
    }

    &:hover {
      border-color: rgba($pewter, 0.45);
    }

    &:focus-visible {
      outline: none;
      border-color: $azure-bolt;
      box-shadow: 0 0 0 3px rgba($azure-bolt, 0.25);
    }

    &:checked {
      background-color: $azure-bolt;
      border-color: $azure-bolt;

      &::after {
        opacity: 1;
      }
    }

    &:disabled {
      opacity: $form-disabled-opacity;
      cursor: not-allowed;
    }
  }

  &__label {
    user-select: none;
  }

  &--disabled {
    opacity: $form-disabled-opacity;
    cursor: not-allowed;
  }
}

// ─── Radio group (vertical stack) ───────────────────────────────────────────
.form-radio-group {
  display: flex;
  flex-direction: column;
  gap: 0.625rem;
}

// ─── Toggle / Switch ────────────────────────────────────────────────────────
.form-toggle {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  font-family: $font-body;
  font-size: 0.95rem;
  color: $form-text;

  &__track {
    position: relative;
    width: 2.75rem;
    height: 1.5rem;
    flex-shrink: 0;
    background-color: rgba($pewter, 0.3);
    border: 1px solid $form-border;
    border-radius: 1.5rem;
    transition: background-color $transition-fast,
                border-color $transition-fast;
  }

  &__thumb {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 1.125rem;
    height: 1.125rem;
    background-color: $pewter;
    border-radius: 50%;
    transition: transform $transition-fast,
                background-color $transition-fast;
  }

  &__input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
    pointer-events: none;

    &:checked + .form-toggle__track {
      background-color: $azure-bolt;
      border-color: $azure-bolt;

      .form-toggle__thumb {
        transform: translateX(1.25rem);
        background-color: $quicksilver;
      }
    }

    &:focus-visible + .form-toggle__track {
      box-shadow: 0 0 0 3px rgba($azure-bolt, 0.25);
    }

    &:disabled + .form-toggle__track {
      opacity: $form-disabled-opacity;
      cursor: not-allowed;
    }
  }

  &__label {
    user-select: none;
  }

  &--disabled {
    opacity: $form-disabled-opacity;
    cursor: not-allowed;
  }
}
